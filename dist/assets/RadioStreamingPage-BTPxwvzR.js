import{j as e,X as N,q as S,r as C,s as L,l as P,T as E,t as I,U as w,v as A,w as M,x as R,y as D,z as j,A as K}from"./index-BJNlBc_g.js";import{r as n}from"./charts-vendor-DhOxG2_S.js";import"./react-vendor-Bzgz95E1.js";const T=({data:a,onClose:r,onSave:c})=>{const[i,d]=n.useState(a),[x,o]=n.useState(null);n.useEffect(()=>{d(a)},[a]);const m=u=>{const{name:b,value:g}=u.target;d(f=>({...f,[b]:g})),o(null)},h=u=>{if(u.preventDefault(),!i.youtubeLink){o("Link Youtube wajib diisi.");return}c(i)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Edit Live Streaming"}),e.jsx("button",{onClick:r,children:e.jsx(N,{className:"h-6 w-6 text-gray-500 hover:text-gray-800"})})]}),e.jsxs("form",{onSubmit:h,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link Youtube"}),e.jsx("input",{type:"text",name:"youtubeLink",value:i.youtubeLink,onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-dark-teal"})]}),x&&e.jsx("p",{className:"text-red-500 text-sm",children:x}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Simpan"})]})]})]})})},z=()=>{const[a,r]=n.useState({title:"Loading...",youtubeLink:"",whatsappLink:"",isPublished:!1,messages:[]}),[c,i]=n.useState(""),d=n.useRef(null),[x,o]=n.useState(!1),m=async()=>{const s=await M();r(s)};n.useEffect(()=>{m();const s=setInterval(m,5e3);return()=>clearInterval(s)},[]),n.useEffect(()=>{var s;(s=d.current)==null||s.scrollIntoView({behavior:"smooth"})},[a.messages]);const h=async(s,l)=>{const t={...a,[s]:l};r(t),await j(t)},u=async(s,l,t)=>{const p=await K({sender:t,message:s,isAdmin:l});p&&r(y=>({...y,messages:[...y.messages,p]}))},b=s=>{s.preventDefault(),c.trim()!==""&&(u(c,!0,"Admin"),i(""))},g=async s=>{console.log("Saving data:",s);const l={id:s.id,title:s.title,youtubeLink:s.youtubeLink,whatsappLink:s.whatsappLink,isPublished:s.isPublished},t=await j(l);console.log("Save result:",t),t?(o(!1),await m()):alert("Gagal menyimpan perubahan. Silakan coba lagi.")},f=async()=>{const s=!a.isPublished;s&&window.confirm("Mulai sesi baru? Klik OK untuk menghapus chat lama, atau Cancel untuk melanjutkan sesi sebelumnya.")&&r(t=>({...t,messages:[]})),await h("isPublished",s),s&&await R({type:"live-streaming",title:"Live Streaming Dimulai!",message:"Siaran langsung sedang berlangsung. Yuk tonton!",timestamp:new Date,isRead:!1})},k=async()=>{await h("isPublished",!1)},v=async()=>{window.confirm("Apakah Anda yakin ingin menghapus semua pesan chat? Tindakan ini tidak dapat dibatalkan.")&&(await D()?(r(t=>({...t,messages:[]})),alert("Chat berhasil dihapus!")):alert("Gagal menghapus chat. Silakan coba lagi."))};return e.jsxs("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-md border border-gray-200 h-full flex flex-col space-y-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-dark-teal pb-4 border-b",children:"Kelola Live Streaming"}),e.jsx("div",{className:"overflow-x-auto border-2 border-gray-300 rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-gray-100 border-b-2 border-gray-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Link Youtube"}),e.jsx("th",{className:"px-4 py-3 w-32"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-red-600 truncate max-w-xs",children:e.jsx("a",{href:a.youtubeLink,target:"_blank",rel:"noopener noreferrer",children:a.youtubeLink})}),e.jsxs("td",{className:"px-4 py-3 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:f,title:a.isPublished?"Pause":"Play",children:a.isPublished?e.jsx(S,{className:"h-6 w-6 text-green-600 hover:text-green-800"}):e.jsx(C,{className:"h-6 w-6 text-green-600 hover:text-green-800"})}),e.jsx("button",{onClick:k,title:"Stop",children:e.jsx(L,{className:"h-6 w-6 text-red-600 hover:text-red-800"})}),e.jsx("button",{onClick:()=>o(!0),title:"Edit",children:e.jsx(P,{className:"h-6 w-6 text-dark-teal hover:text-teal-800"})}),e.jsx("button",{onClick:v,title:"Hapus Semua Chat",children:e.jsx(E,{className:"h-6 w-6 text-red-600 hover:text-red-800"})})]})]})})]})}),e.jsxs("div",{className:"flex-grow flex flex-col pt-4 min-h-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(I,{className:"h-6 w-6 text-gray-800"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Live Chat"})]}),e.jsx("div",{className:"flex-grow border-2 border-gray-300 rounded-xl p-4 overflow-hidden flex flex-col bg-white shadow-inner",children:e.jsxs("div",{className:"overflow-y-auto custom-scrollbar flex-grow space-y-4 pr-2",children:[a.messages.map(s=>e.jsxs("div",{className:`flex items-start space-x-3 ${s.isAdmin?"justify-end":""}`,children:[!s.isAdmin&&e.jsx(w,{className:"h-8 w-8 text-gray-600 flex-shrink-0 mt-1"}),e.jsxs("div",{className:`px-4 py-2 rounded-2xl max-w-sm ${s.isAdmin?"bg-[#9cc2c9] text-gray-900 rounded-br-none":"bg-white text-gray-800 border border-gray-300 rounded-bl-none"}`,children:[!s.isAdmin&&e.jsx("p",{className:"font-bold text-sm text-gray-900 mb-1",children:s.sender}),s.isAdmin&&e.jsx("p",{className:"font-bold text-sm text-gray-900 mb-1 text-right",children:"Admin"}),e.jsx("p",{className:"text-sm",children:s.message})]}),s.isAdmin&&e.jsx(w,{className:"h-8 w-8 text-dark-teal flex-shrink-0 mt-1"})]},s.id)),e.jsx("div",{ref:d})]})}),e.jsxs("form",{onSubmit:b,className:"mt-4 relative",children:[e.jsx("input",{type:"text",value:c,onChange:s=>i(s.target.value),placeholder:"Balas Komentar",className:"w-full px-6 py-4 text-gray-600 bg-white border-2 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-dark-teal shadow-sm text-lg"}),e.jsx("button",{type:"submit",className:"absolute right-4 top-1/2 -translate-y-1/2 text-dark-teal p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Kirim Komentar",children:e.jsx(A,{className:"h-8 w-8"})})]})]}),x&&e.jsx(T,{data:a,onClose:()=>o(!1),onSave:g}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 8px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #c1c1c1;
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #a8a8a8;
                }
            `})]})};export{z as default};
