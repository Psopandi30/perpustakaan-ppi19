import{j as e,U as v,e as S,N as A,g as U,s as E}from"./index-BiA865_u.js";import{r as n}from"./charts-vendor-DhOxG2_S.js";import"./react-vendor-Bzgz95E1.js";const D=()=>{const[o,u]=n.useState([]),[x,g]=n.useState({}),[i,h]=n.useState(null),[m,f]=n.useState(""),[d,p]=n.useState(""),y=n.useRef(null),[k,b]=n.useState(!0),j=async()=>{b(!0);try{const s=await A();u(s);const t=await U(),a={};s.forEach(l=>{a[l.id]={messages:[],unreadByAdmin:!1,unreadByUser:!1}}),t.forEach(l=>{const c=s.find(N=>N.username===l.sender||N.namaLengkap===l.sender);c?(a[c.id]||(a[c.id]={messages:[],unreadByAdmin:!1,unreadByUser:!1}),a[c.id].messages.push(l)):l.sender}),g(a)}catch(s){console.error("Error loading chat data:",s),u([]),g({})}finally{b(!1)}};n.useEffect(()=>{j()},[]);const r=i?x[i.id]:null;n.useEffect(()=>{var s;(s=y.current)==null||s.scrollIntoView({behavior:"smooth"})},[r==null?void 0:r.messages]);const C=s=>{h(s),p("")},L=async s=>{s.preventDefault(),m.trim()&&i&&(await E({sender:"Admin",message:m,isAdmin:!0}),j(),f(""))},w=o.filter(s=>s.namaLengkap.toLowerCase().includes(d.toLowerCase())||s.username.toLowerCase().includes(d.toLowerCase()));return k?e.jsx("div",{className:"p-6",children:"Loading chats..."}):i?e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 h-full flex flex-col",style:{minHeight:"calc(100vh - 150px)"},children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg flex justify-between items-center",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Chat with ",i.namaLengkap]}),e.jsx("button",{onClick:()=>h(null),className:"text-sm font-semibold text-blue-600 hover:underline focus:outline-none",children:"Cari Pengguna Lain"})]}),e.jsx("div",{className:"flex-grow p-4 overflow-y-auto bg-gray-100",children:e.jsxs("div",{className:"space-y-4",children:[r==null?void 0:r.messages.map(s=>e.jsxs("div",{className:`flex items-start space-x-3 ${s.isAdmin?"justify-end":""}`,children:[!s.isAdmin&&e.jsx(v,{className:"h-6 w-6 text-gray-400 flex-shrink-0 mt-1"}),e.jsxs("div",{className:`px-4 py-2 rounded-2xl max-w-lg ${s.isAdmin?"bg-dark-teal text-white rounded-br-none":"bg-white text-gray-700 border border-gray-200 rounded-bl-none"}`,children:[e.jsx("p",{children:s.message}),e.jsx("p",{className:"text-xs opacity-60 mt-1 text-right",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),s.isAdmin&&e.jsx(v,{className:"h-6 w-6 text-dark-teal flex-shrink-0 mt-1"})]},s.id)),(!r||r.messages.length===0)&&e.jsx("p",{className:"text-center text-gray-500 pt-10",children:"Mulai percakapan."}),e.jsx("div",{ref:y})]})}),e.jsx("form",{onSubmit:L,className:"p-4 border-t bg-white rounded-b-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"text",value:m,onChange:s=>f(s.target.value),placeholder:"Ketik balasan...",className:"w-full px-4 py-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-dark-teal"}),e.jsx("button",{type:"submit",className:"text-dark-teal p-2 rounded-full hover:bg-gray-200","aria-label":"Kirim Pesan",children:e.jsx(S,{className:"h-6 w-6"})})]})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 h-full p-6",style:{minHeight:"calc(100vh - 150px)"},children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-6",children:"Chat Pengguna"}),e.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Cari nama atau username...",value:d,onChange:s=>p(s.target.value),className:"w-full px-4 py-3 text-lg text-gray-700 bg-white border-2 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-dark-teal"}),e.jsxs("ul",{className:"border border-gray-200 rounded-xl divide-y divide-gray-100 shadow-sm",children:[(d?w:o).map(s=>{const t=x[s.id],a=t==null?void 0:t.messages[t.messages.length-1],l=t==null?void 0:t.unreadByAdmin;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>C(s),className:"w-full text-left p-4 hover:bg-teal-50 flex justify-between items-center transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:s.namaLengkap}),e.jsxs("p",{className:"text-sm text-gray-500",children:["@",s.username]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-1",children:a?`${a.isAdmin?"Admin: ":"Pengguna: "}${a.message}`:"Belum ada percakapan"})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:a?new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),l&&e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full flex-shrink-0"})]})]})},s.id)}),(d?w:o).length===0&&e.jsx("li",{className:"p-6 text-center text-gray-500",children:"Pengguna tidak ditemukan."})]})]})]})};export{D as default};
