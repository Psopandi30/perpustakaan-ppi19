import{j as e,X as v,W as T,D as S,r as C,K as F,T as W,l as D,a6 as L,O as y,a7 as P,a4 as G,a8 as I}from"./index-BiA865_u.js";import{r as x,R as K}from"./charts-vendor-DhOxG2_S.js";import{t as k}from"./date-Bvg2Sx2u.js";import{i as N,r as w}from"./file-C-CVBF3a.js";import"./react-vendor-Bzgz95E1.js";const A=({work:l,onClose:c,onSave:d})=>{const[n,h]=x.useState({...l,tanggalTerbit:k(l.tanggalTerbit)}),[i,m]=x.useState(null),[g,b]=x.useState(l.isFeatured||!1);x.useEffect(()=>{h({...l,tanggalTerbit:k(l.tanggalTerbit)}),b(l.isFeatured||!1)},[l]);const f=a=>{const{name:o,value:u}=a.target;h(p=>({...p,[o]:u})),m(null)},r=a=>{a.preventDefault();const{id:o,content:u,...p}=n;if(Object.values(p).some(j=>typeof j=="string"&&j.trim()==="")){m("Semua kolom wajib diisi.");return}d({...n,content:"",isFeatured:g})},t=[{name:"judul",label:"Judul Karya Tulis Santri",type:"text"},{name:"namaPenulis",label:"Nama Penulis",type:"text"},{name:"tanggalTerbit",label:"Tanggal Terbit",type:"date"},{name:"drafLink",label:"Link Draf Google Drive",type:"text"}],s=async a=>{var u;const o=(u=a.target.files)==null?void 0:u[0];if(o){if(!N(o)){m("Format cover harus JPG atau PNG."),a.target.value="";return}try{const p=await w(o);h(j=>({...j,coverLink:p})),m(null)}catch{m("Gagal membaca file cover.")}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Edit Karya Tulis Santri"}),e.jsx("button",{onClick:c,"aria-label":"Close modal",children:e.jsx(v,{className:"h-6 w-6 text-gray-500 hover:text-gray-800"})})]}),e.jsxs("form",{onSubmit:r,className:"p-6 space-y-4",children:[t.map(a=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:`edit-${a.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:a.label}),e.jsx("input",{type:a.type,id:`edit-${a.name}`,name:a.name,value:String(n[a.name]),onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-dark-teal"})]},a.name)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Cover (JPG/PNG)"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg",onChange:s,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-dark-teal"}),n.coverLink&&e.jsx("img",{src:n.coverLink,alt:"Preview Cover",className:"mt-3 h-32 w-full object-cover rounded-md border"})]}),i&&e.jsx("p",{className:"text-red-500 text-sm",role:"alert",children:i}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"editIsFeatured",checked:g,onChange:a=>b(a.target.checked),className:"rounded border-gray-300 text-brand-yellow focus:ring-brand-yellow"}),e.jsx("label",{htmlFor:"editIsFeatured",className:"text-sm text-gray-700 font-medium",children:"Tampilkan di Rak Depan/Beranda"})]}),e.jsxs("div",{className:"flex justify-end items-center pt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})})},E=({onClose:l,onSave:c})=>{const[d,n]=x.useState({judul:"",namaPenulis:"",tanggalTerbit:"",coverLink:"",drafLink:"",content:"",isFeatured:!1}),[h,i]=x.useState(null),m=r=>{const{name:t,value:s,type:a}=r.target,o=r.target.checked;n(u=>({...u,[t]:a==="checkbox"?o:s})),i(null)},g=r=>{r.preventDefault();const{content:t,...s}=d,{isFeatured:a,...o}=s;if(Object.values(o).some(u=>typeof u=="string"&&u.trim()==="")){i("Semua kolom wajib diisi.");return}c({...d,content:""})},b=[{name:"judul",label:"Judul Karya Tulis Santri",type:"text"},{name:"namaPenulis",label:"Nama Penulis",type:"text"},{name:"tanggalTerbit",label:"Tanggal Terbit",type:"date"},{name:"drafLink",label:"Link Draf Google Drive",type:"text"}],f=async r=>{var s;const t=(s=r.target.files)==null?void 0:s[0];if(t){if(!N(t)){i("Format cover harus JPG atau PNG."),r.target.value="";return}try{const a=await w(t);n(o=>({...o,coverLink:a})),i(null)}catch{i("Gagal membaca file cover.")}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Tambah Karya Tulis Santri"}),e.jsx("button",{onClick:l,"aria-label":"Close modal",children:e.jsx(v,{className:"h-6 w-6 text-gray-500 hover:text-gray-800"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[b.map(r=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:`add-${r.name}`,className:"block text-sm font-medium text-gray-700 mb-1",children:r.label}),e.jsx("input",{type:r.type,id:`add-${r.name}`,name:r.name,value:String(d[r.name]),onChange:m,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-dark-teal"})]},r.name)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Cover (JPG/PNG)"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg",onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-dark-teal"}),d.coverLink&&e.jsx("img",{src:d.coverLink,alt:"Preview Cover",className:"mt-3 h-32 w-full object-cover rounded-md border"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"add-isFeatured",name:"isFeatured",checked:d.isFeatured,onChange:m,className:"h-4 w-4 text-dark-teal border-gray-300 rounded focus:ring-dark-teal"}),e.jsx("label",{htmlFor:"add-isFeatured",className:"ml-2 block text-sm text-gray-900",children:"Tampilkan di Beranda (Featured)"})]}),h&&e.jsx("p",{className:"text-red-500 text-sm",role:"alert",children:h}),e.jsxs("div",{className:"flex justify-end items-center pt-4 space-x-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Batal"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition-colors",children:"Simpan"})]})]})]})})},O=()=>{const[l,c]=x.useState([]),[d,n]=x.useState(!1),[h,i]=x.useState(null),[m,g]=x.useState(!0);K.useEffect(()=>{(async()=>{g(!0);try{const s=await D();c(s)}catch(s){console.error("Error loading written works:",s),c([])}finally{g(!1)}})()},[]);const b=async t=>{const s=await P(t);s?(c([...l,s]),n(!1),G({type:"karya-tulis",title:"Karya Tulis Santri Baru Tersedia!",message:`Karya Tulis "${s.judul}" telah ditambahkan. Silakan baca sekarang!`,timestamp:new Date,isRead:!1}),y.success("Karya Tulis Santri berhasil ditambahkan dan notifikasi terkirim.")):y.error("Gagal menambahkan karya tulis santri. Silakan coba lagi.")},f=async t=>{window.confirm("Apakah Anda yakin ingin menghapus karya tulis santri ini?")&&(await L(t)?(c(l.filter(a=>a.id!==t)),y.success("Karya Tulis Santri berhasil dihapus.")):y.error("Gagal menghapus karya tulis santri."))},r=async t=>{await I(t)?(c(l.map(a=>a.id===t.id?t:a)),i(null),y.success("Karya Tulis Santri berhasil diperbarui.")):y.error("Gagal mengupdate karya tulis santri.")};return m?e.jsx("div",{className:"p-6 text-center",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md border border-gray-200 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-8 w-8 text-dark-teal"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 uppercase tracking-wide",children:"DAFTAR KARYA TULIS SANTRI"})]}),e.jsx("button",{onClick:()=>n(!0),className:"flex items-center justify-center bg-green-500 text-white font-bold p-2 rounded shadow hover:bg-green-600 transition-colors duration-300",title:"Tambahkan Karya Tulis Santri",children:e.jsx(S,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"border-2 border-gray-300 rounded-lg overflow-hidden",style:{maxHeight:"600px",overflow:"auto"},children:e.jsxs("table",{className:"min-w-full bg-white text-sm",children:[e.jsx("thead",{className:"bg-gray-100 border-b-2 border-gray-300 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"No"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Judul Karya Tulis Santri"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Tahun Terbit"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Penulis"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Cover"}),e.jsx("th",{className:"px-4 py-3 text-left font-semibold text-gray-600",children:"Link Draf Google Drive"}),e.jsx("th",{className:"px-4 py-3 w-24"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[l.map((t,s)=>{const a=C(t.coverLink);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-500",children:s+1}),e.jsx("td",{className:"px-4 py-3 font-medium text-green-700",children:t.judul}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:t.tanggalTerbit}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:t.namaPenulis}),e.jsx("td",{className:"px-4 py-3",children:a?e.jsx("img",{src:a,alt:`Cover ${t.judul}`,className:"h-16 w-12 object-cover rounded-md border"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Belum ada cover"})}),e.jsx("td",{className:"px-4 py-3 text-blue-600 hover:underline",children:e.jsx("a",{href:t.drafLink,target:"_blank",rel:"noopener noreferrer",children:"Link Buku Google Drive"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>i(t),className:"text-black hover:text-gray-700",title:"Edit",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>f(t.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(W,{className:"h-5 w-5"})})]})})]},t.id)}),l.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-gray-500",children:"Tidak ada data karya tulis santri."})})]})]})})]}),d&&e.jsx(E,{onClose:()=>n(!1),onSave:b}),h&&e.jsx(A,{work:h,onClose:()=>i(null),onSave:r}),e.jsx("style",{children:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 10px;
                    height: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: #f1f1f1;
                    border-radius: 5px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: #000;
                    border-radius: 5px;
                    border: 2px solid #f1f1f1;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: #555;
                }
            `})]})};export{O as default};
